<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡¶Ç‡¶ó‡¶†‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ - ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞ ‡¶™‡ßç‡¶∞‡ßã</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --primary: #27ae60; --danger: #e74c3c; --blue: #2196f3; --dark: #2c3e50; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 480px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .total-card { background: linear-gradient(135deg, var(--dark), #456789); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        .total-card h1 { font-size: 32px; margin: 10px 0; color: #f1c40f; }
        .box { background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 15px; }
        h3 { margin-top: 0; font-size: 18px; border-bottom: 2px solid #f4f4f4; padding-bottom: 8px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; transition: 0.3s; }
        .btn-search { background: var(--primary); }
        .btn-depo { background: var(--blue); }
        .btn-exp { background: var(--danger); }
        #profileResult { display: none; padding: 15px; background: #fff; border-radius: 10px; border: 2px solid var(--primary); margin-top: 10px; text-align: left; }
        .profile-header { text-align: center; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .profile-img { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 14px; }
        .info-row b { color: #555; min-width: 100px; }
        .info-row span { text-align: right; color: #333; }
        .section-title { background: #eee; padding: 12px; margin-top: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .hidden-content { display: none; padding: 10px; background: #fff; border: 1px solid #eee; border-radius: 0 0 8px 8px; max-height: 250px; overflow-y: auto; }
        .log-item { padding: 8px; border-bottom: 1px solid #eee; font-size: 13px; display: flex; flex-direction: column; }
        .btn-setup { background: #8e44ad; font-size: 12px; margin-top: 20px; opacity: 0.8; }
    </style>
</head>
<body>

<div class="container">
    <div class="total-card">
        <span>‡¶∏‡¶Ç‡¶ó‡¶†‡¶®‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶´‡¶æ‡¶®‡ßç‡¶°</span>
        <h1>‡ß≥ <span id="orgTotalDisplay">...</span></h1>
    </div>

    <div class="box">
        <h3>üîç ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
        <input type="number" id="searchId" placeholder="‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶®">
        <button class="btn-search" onclick="searchUser()">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        
        <div id="profileResult">
            <div class="profile-header">
                <img id="pImg" src="" class="profile-img">
                <h3 id="pName" style="margin:5px 0; color: var(--primary);"></h3>
                <span id="pRole" style="background: #e8f5e9; padding: 2px 10px; border-radius: 10px; font-size: 12px; color: var(--primary);"></span>
            </div>
            
            <div class="info-row"><b>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</b> <span id="pAddress"></span></div>
            <div class="info-row"><b>‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</b> <span id="pFather"></span></div>
            <div class="info-row"><b>‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</b> <span id="pMother"></span></div>
            <div class="info-row"><b>‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</b> <span id="pPhone"></span></div>
            <div class="info-row"><b>‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™:</b> <span id="pBlood" style="color:red; font-weight:bold;"></span></div>
            <div class="info-row"><b>‡¶è‡¶®‡¶Ü‡¶á‡¶°‡¶ø:</b> <span id="pNID"></span></div>
            <div class="info-row"><b>‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï:</b> <a id="pFB" href="#" target="_blank" style="text-decoration:none; color:var(--blue);">‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</a></div>
            
            <div class="info-row" style="border:none; margin-top:10px; font-size:16px; background: #f0fdf4; padding: 10px; border-radius: 8px;">
                <b>‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶π‡¶¨‡¶ø‡¶≤:</b> 
                <span style="color:var(--primary); font-weight:bold;">‡ß≥ <span id="pBalance">0</span></span>
            </div>
        </div>
    </div>

    <div class="box" style="border-left: 5px solid var(--blue);">
        <h3>üí∞ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</h3>
        <input type="number" id="depoId" placeholder="‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ü‡¶á‡¶°‡¶ø">
        <input type="number" id="depoAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
        <input type="password" id="depoPin" placeholder="‡¶ú‡¶Æ‡¶æ ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡¶®">
        <button class="btn-depo" onclick="addMoney()">‡¶ú‡¶Æ‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div class="box" style="border-left: 5px solid var(--danger);">
        <h3>üí∏ ‡¶ñ‡¶∞‡¶ö (Admin)</h3>
        <input type="number" id="expAmount" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
        <input type="text" id="expReason" placeholder="‡¶ï‡¶æ‡¶∞‡¶£">
        <input type="password" id="adminPin" placeholder="‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡¶®">
        <button class="btn-exp" onclick="withdrawMoney()">‡¶ñ‡¶∞‡¶ö ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div class="section-title" onclick="toggleSec('statement')">üìä ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ (‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡ß®‡ß¶‡¶ü‡¶ø)</div>
    <div id="statement" class="hidden-content">
        <div id="logList">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>
    </div>

</div>

<script>
    const firebaseConfig = {
        databaseURL: "https://coffee-spark-ai-barista-46e11-default-rtdb.firebaseio.com/",
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let totalFund = 0;

    // ‡ßß. ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶´‡¶æ‡¶®‡ßç‡¶° ‡¶è‡¶¨‡¶Ç ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶∞‡¶ø‡¶° (‡¶Ö‡¶™‡ßç‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡¶°)
    database.ref('totalFund').on('value', (s) => {
        totalFund = s.val() || 0;
        document.getElementById("orgTotalDisplay").innerText = totalFund;
    });

    database.ref('logs').limitToLast(20).on('value', (snapshot) => {
        let logList = document.getElementById("logList");
        logList.innerHTML = "";
        if(snapshot.exists()){
            snapshot.forEach(child => {
                let log = child.val();
                logList.innerHTML = `<div class="log-item"><b>${log.msg}</b><small>${log.time}</small></div>` + logList.innerHTML;
            });
        }
    });

    // ‡ß®. ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö (‡ßß ‡¶≤‡¶ï‡ßç‡¶∑ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶â‡¶™‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§)
    async function searchUser() {
        let id = document.getElementById("searchId").value;
        if(!id) return alert("‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶®!");
        
        const snap = await database.ref('members/' + id).once('value');
        if(snap.exists()){
            let m = snap.val();
            document.getElementById("pName").innerText = m.name;
            document.getElementById("pRole").innerText = m.role;
            document.getElementById("pAddress").innerText = m.address;
            document.getElementById("pFather").innerText = m.father;
            document.getElementById("pMother").innerText = m.mother;
            document.getElementById("pPhone").innerText = m.phone;
            document.getElementById("pBlood").innerText = m.blood;
            document.getElementById("pNID").innerText = m.nid;
            document.getElementById("pBalance").innerText = m.balance;
            document.getElementById("pImg").src = m.img || "https://via.placeholder.com/90";
            document.getElementById("profileResult").style.display = "block";
        } else {
            alert("‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!");
        }
    }

    // ‡ß©. ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ (‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞ ‡¶™‡¶ø‡¶® ‡¶ö‡ßá‡¶ï)
    async function addMoney() {
        let id = document.getElementById("depoId").value;
        let amount = parseInt(document.getElementById("depoAmount").value);
        let pin = document.getElementById("depoPin").value;

        // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶ø‡¶® ‡¶ö‡ßá‡¶ï
        const pinSnap = await database.ref('security/depoPin').once('value');
        if (pin !== pinSnap.val()) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø ‡¶™‡¶ø‡¶®!");

        const userSnap = await database.ref('members/' + id).once('value');
        if(userSnap.exists() && amount > 0){
            let m = userSnap.val();
            let newBal = (m.balance || 0) + amount;
            
            await database.ref('members/' + id).update({ balance: newBal });
            await database.ref('totalFund').set(totalFund + amount);
            await database.ref('logs').push({
                msg: `[+] ‡¶ú‡¶Æ‡¶æ: ‡ß≥${amount} (ID: ${id})`,
                time: new Date().toLocaleString('bn-BD')
            });
            alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            document.getElementById("depoAmount").value = "";
            document.getElementById("depoPin").value = "";
        }
    }

    // ‡ß™. ‡¶ñ‡¶∞‡¶ö (‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶ø‡¶® ‡¶ö‡ßá‡¶ï)
    async function withdrawMoney() {
        let amount = parseInt(document.getElementById("expAmount").value);
        let reason = document.getElementById("expReason").value;
        let pin = document.getElementById("adminPin").value;

        const pinSnap = await database.ref('security/adminPin').once('value');
        if (pin !== pinSnap.val()) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶ø‡¶®!");

        if (amount > 0 && amount <= totalFund) {
            await database.ref('totalFund').set(totalFund - amount);
            await database.ref('logs').push({
                msg: `[-] ‡¶ñ‡¶∞‡¶ö: ‡ß≥${amount} (${reason})`,
                time: new Date().toLocaleString('bn-BD')
            });
            alert("‡¶ñ‡¶∞‡¶ö ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        }
    }

    // ‡ß´. ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ (‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    function setupDatabase() {
        database.ref('security').set({
        });
        // ‡ßß‡ß¶ ‡¶ú‡¶® ‡¶°‡ßá‡¶Æ‡ßã ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡¶æ (‡¶¨‡¶æ‡¶ï‡¶ø‡¶∞‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶™‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶π‡¶¨‡ßá)
        database.ref('totalFund').set(15000);
        alert("‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø ‡¶™‡¶ø‡¶® ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶è‡¶ñ‡¶® ‡¶á‡¶®‡¶∏‡ßç‡¶™‡ßá‡¶ï‡ßç‡¶ü ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá‡¶ì ‡¶™‡¶ø‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§");
    }

    function toggleSec(id) {
        let sec = document.getElementById(id);
        sec.style.display = (sec.style.display === "block") ? "none" : "block";
    }
</script>
</body>
</html>
