<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BICS - ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --primary: #27ae60; --danger: #e74c3c; --blue: #2196f3; --dark: #2c3e50; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 550px; margin: auto; }
        .total-card { background: linear-gradient(135deg, var(--dark), #456789); color: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .total-card h1 { font-size: 35px; margin: 10px 0; color: #f1c40f; }
        .box { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; font-size: 18px; border-bottom: 2px solid #eee; padding-bottom: 8px; color: var(--dark); text-align: center; }
        input, select { width: 100%; padding: 10px; margin: 6px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        .row { display: flex; gap: 10px; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; margin-top: 10px; transition: 0.3s; }
        .btn-search { background: var(--dark); }
        .btn-reg { background: var(--primary); }
        .btn-depo { background: var(--blue); }
        .btn-exp { background: var(--danger); }
        .preview-img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; display: none; margin: 10px auto; border: 3px solid var(--primary); }
        #profileResult { display: none; text-align: left; padding: 15px; border: 2px solid var(--primary); border-radius: 10px; background: #fff; margin-top: 15px; }
        .profile-header { text-align: center; margin-bottom: 10px; }
        .info-item { border-bottom: 1px solid #eee; padding: 5px 0; font-size: 14px; }
        .log-list { max-height: 150px; overflow-y: auto; font-size: 13px; background: #eee; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <div class="total-card">
        <span>‡¶∏‡¶Ç‡¶ó‡¶†‡¶®‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶´‡¶æ‡¶®‡ßç‡¶°</span>
        <h1>‡ß≥ <span id="orgTotalDisplay">...</span></h1>
    </div>

    <div class="box">
        <h3>üîç ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö</h3>
        <input type="number" id="searchId" placeholder="‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶¶‡¶ø‡¶®">
        <button class="btn-search" onclick="searchMember()">‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        
        <div id="profileResult">
            <div class="profile-header">
                <img id="pImg" class="preview-img" style="display:inline-block;">
                <h2 id="pName" style="margin:5px 0; color: var(--primary);"></h2>
                <span id="pTitle" style="color: #666; font-style: italic; font-weight: bold;"></span>
            </div>
            <div class="info-item"><b>‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</b> <span id="pFather"></span></div>
            <div class="info-item"><b>‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</b> <span id="pMother"></span></div>
            <div class="info-item"><b>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</b> <span id="pAddress"></span></div>
            <div class="info-item"><b>‡¶è‡¶®‡¶Ü‡¶á‡¶°‡¶ø:</b> <span id="pNid"></span></div>
            <div class="info-item"><b>‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™:</b> <span id="pBlood"></span></div>
            <div class="info-item"><b>‡¶´‡ßã‡¶®:</b> <span id="pPhone"></span></div>
            <div class="info-item"><b>‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï:</b> <a id="pFb" target="_blank" style="color: var(--blue); text-decoration: none;">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</a></div>
            <div class="info-item" style="background:#e8f5e9; padding: 10px; border-radius: 5px; margin-top:10px; text-align: center;"><b>‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶π‡¶¨‡¶ø‡¶≤:</b> ‡ß≥ <span id="pBalance" style="font-size: 18px; color: var(--primary);">0</span></div>
        </div>
    </div>

    <div class="box">
        <h3>üìù ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶®</h3>
        <div class="row">
            <input type="text" id="regTitle" placeholder="‡¶™‡¶¶‡¶¨‡ßÄ">
            <input type="number" id="regId" placeholder="‡¶Ü‡¶á‡¶°‡¶ø">
        </div>
        <input type="text" id="regName" placeholder="‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ">
        <div class="row">
            <input type="text" id="regFather" placeholder="‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <input type="text" id="regMother" placeholder="‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
        </div>
        <input type="text" id="regAddress" placeholder="‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
        <div class="row">
            <input type="number" id="regNid" placeholder="‡¶è‡¶®‡¶Ü‡¶á‡¶°‡¶ø ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞">
            <select id="regBlood">
                <option value="">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</option>
                <option value="A+">A+</option><option value="A-">A-</option>
                <option value="B+">B+</option><option value="B-">B-</option>
                <option value="O+">O+</option><option value="O-">O-</option>
                <option value="AB+">AB+</option><option value="AB-">AB-</option>
            </select>
        </div>
        <input type="text" id="regFb" placeholder="‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï">
        <input type="text" id="regPhone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
        
        <label style="font-size: 12px; color: #666;">‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡ßá‡¶∞ ‡¶õ‡¶¨‡¶ø (‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø ‡¶•‡ßá‡¶ï‡ßá):</label>
        <input type="file" id="regPhoto" accept="image/*" onchange="previewImg(this)">
        <img id="imgPrev" class="preview-img">
        
        <input type="password" id="regPin" placeholder="‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶® ‡¶™‡¶ø‡¶® ‡¶¶‡¶ø‡¶®">
        <button class="btn-reg" onclick="saveMember()">‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div class="box">
        <h3>üí∞ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® (‡¶ú‡¶Æ‡¶æ ‡¶ì ‡¶ñ‡¶∞‡¶ö)</h3>
        <input type="number" id="transId" placeholder="‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ü‡¶á‡¶°‡¶ø (‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶ú‡¶Æ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)">
        <input type="number" id="transAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
        <input type="text" id="transReason" placeholder="‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£">
        <input type="password" id="transPin" placeholder="‡¶™‡¶ø‡¶® ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®">
        <div class="row">
            <button class="btn-depo" onclick="addMoney()">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ</button>
            <button class="btn-exp" onclick="withdrawMoney()">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ñ‡¶∞‡¶ö</button>
        </div>
    </div>

    <div class="box">
        <h3>üìä ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
        <div id="logList" class="log-list">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>
    

<script>
    // ‡¶´‡¶æ‡ßü‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
    const firebaseConfig = {
        databaseURL: "https://coffee-spark-ai-barista-46e11-default-rtdb.firebaseio.com/",
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let totalFund = 0;

    // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
    database.ref('totalFund').on('value', (s) => {
        totalFund = s.val() || 0;
        document.getElementById("orgTotalDisplay").innerText = totalFund;
    });

    database.ref('logs').limitToLast(10).on('value', (s) => {
        let list = document.getElementById("logList");
        list.innerHTML = "";
        s.forEach(child => {
            let log = child.val();
            list.innerHTML = `<div style="padding:5px 0;">‚Ä¢ ${log.msg} <br><small style="color:#888;">${log.time}</small></div><hr style="border:0; border-top:1px solid #ddd;">` + list.innerHTML;
        });
    });

    function previewImg(input) {
        if (input.files && input.files[0]) {
            let reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('imgPrev').src = e.target.result;
                document.getElementById('imgPrev').style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // ‡ßß. ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö
    async function searchMember() {
        const id = document.getElementById('searchId').value;
        if(!id) return alert("‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶®!");
        
        const snap = await database.ref('members/' + id).once('value');
        if (snap.exists()) {
            const m = snap.val();
            document.getElementById('pName').innerText = m.name;
            document.getElementById('pTitle').innerText = m.title || "‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø";
            document.getElementById('pFather').innerText = m.father || "-";
            document.getElementById('pMother').innerText = m.mother || "-";
            document.getElementById('pAddress').innerText = m.address || "-";
            document.getElementById('pNid').innerText = m.nid || "-";
            document.getElementById('pBlood').innerText = m.blood || "-";
            document.getElementById('pPhone').innerText = m.phone || "-";
            document.getElementById('pFb').href = m.fb || "#";
            document.getElementById('pBalance').innerText = m.balance;
            document.getElementById('pImg').src = m.img;
            document.getElementById('pImg').style.display = 'inline-block';
            document.getElementById('profileResult').style.display = 'block';
        } else {
            alert("‡¶è‡¶á ‡¶Ü‡¶á‡¶°‡¶ø‡¶§‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!");
        }
    }

    // ‡ß®. ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠
    async function saveMember() {
        const id = document.getElementById('regId').value;
        const name = document.getElementById('regName').value;
        const file = document.getElementById('regPhoto').files[0];
        const inputPin = document.getElementById('regPin').value;

        const pinSnap = await database.ref('security/adminPin').once('value');
        if (inputPin !== pinSnap.val()) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®! ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡ßü‡•§");

        if (!id || !name || !file) return alert("‡¶Ü‡¶á‡¶°‡¶ø, ‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶õ‡¶¨‡¶ø ‡¶¶‡¶ø‡¶®!");

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function(e) {
            const img = new Image();
            img.src = e.target.result;
            img.onload = async function() {
                const canvas = document.createElement('canvas');
                const MAX_WIDTH = 300;
                canvas.width = MAX_WIDTH;
                canvas.height = img.height * (MAX_WIDTH / img.width);
                canvas.getContext("2d").drawImage(img, 0, 0, canvas.width, canvas.height);
                const compressedImg = canvas.toDataURL("image/jpeg", 0.6);

                await database.ref('members/' + id).set({
                    id: id, title: document.getElementById('regTitle').value,
                    name: name, father: document.getElementById('regFather').value,
                    mother: document.getElementById('regMother').value,
                    address: document.getElementById('regAddress').value,
                    nid: document.getElementById('regNid').value,
                    blood: document.getElementById('regBlood').value,
                    fb: document.getElementById('regFb').value,
                    phone: document.getElementById('regPhone').value,
                    img: compressedImg, balance: 0
                });
                alert("‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§!");
                location.reload();
            };
        };
    }

    // ‡ß©. ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ
    async function addMoney() {
        const id = document.getElementById('transId').value;
        const amount = parseInt(document.getElementById('transAmount').value);
        const reason = document.getElementById('transReason').value || "‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ö‡¶æ‡¶Å‡¶¶‡¶æ";
        const pin = document.getElementById('transPin').value;

        const pinSnap = await database.ref('security/depoPin').once('value');
        if (pin !== pinSnap.val()) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®!");

        const userSnap = await database.ref('members/' + id).once('value');
        if (userSnap.exists() && amount > 0) {
            let newBal = (userSnap.val().balance || 0) + amount;
            await database.ref('members/' + id).update({ balance: newBal });
            await database.ref('totalFund').set(totalFund + amount);
            await database.ref('logs').push({ 
                msg: `[+] ‡¶ú‡¶Æ‡¶æ: ‡ß≥${amount} (ID: ${id}) - ‡¶ï‡¶æ‡¶∞‡¶£: ${reason}`, 
                time: new Date().toLocaleString('bn-BD') 
            });
            alert("‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            location.reload();
        } else alert("‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø ‡¶¨‡¶æ ‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø!");
    }

    // ‡ß™. ‡¶ñ‡¶∞‡¶ö
    async function withdrawMoney() {
        const amount = parseInt(document.getElementById('transAmount').value);
        const reason = document.getElementById('transReason').value;
        const pin = document.getElementById('transPin').value;

        const pinSnap = await database.ref('security/adminPin').once('value');
        if (pin !== pinSnap.val()) return alert("‡¶≠‡ßÅ‡¶≤ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶ø‡¶®!");

        if (amount > 0 && amount <= totalFund && reason) {
            await database.ref('totalFund').set(totalFund - amount);
            await database.ref('logs').push({ 
                msg: `[-] ‡¶ñ‡¶∞‡¶ö: ‡ß≥${amount} - ‡¶ï‡¶æ‡¶∞‡¶£: ${reason}`, 
                time: new Date().toLocaleString('bn-BD') 
            });
            alert("‡¶ñ‡¶∞‡¶ö ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!");
            location.reload();
        } else alert("‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á ‡¶¨‡¶æ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßá‡¶®‡¶®‡¶ø!");
    }

    // ‡ß´. ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø ‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ (‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡ßá‡¶®)
    function setupSecurity() {
        database.ref('security').set({
           
        });
        alert("‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡¶è‡¶ñ‡¶® ‡¶è‡¶á ‡¶¨‡¶æ‡¶ü‡¶®‡¶ü‡¶ø ‡¶ï‡ßã‡¶° ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®‡•§");
    }
</script>
</body>
</html>
